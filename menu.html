<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>
        Menu - THE AP HOUSE
    </title>
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js">
    </script>
    <style>
        body {
            background-color: #f8f1e4;
            font-family: 'Times New Roman', Segoe UI, Tahoma, Geneva, Verdana, sans-serif;
        }

        .navbar-custom {
            background-color: #382005;
        }

        .nav-item-custom {
            font-size: 1.1rem;
            font-family: 'Times New Roman', Times, serif;
        }


        /* Dropdown  */
        .dropdown-menu {
            background-color: #f5eee0;
            border-radius: 10px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
            padding: 8px 0;
            font-family: 'Segoe UI', sans-serif;
        }

        .dropdown-menu .dropdown-item {
            padding: 10px 20px;
            font-size: 1rem;
            transition: background-color 0.2s ease-in-out;
            color: #3d2700;
        }

        .dropdown-menu .dropdown-item:hover {
            background-color: #e3d7c1;
            color: #000;
        }

        /*Banner*/
        .category-banner {
            position: relative;
            height: 280px;
            background-size: cover;
            background-position: center;
            margin-bottom: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .category-banner h2 {
            background: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 10px 30px;
            border-radius: 10px;
            font-size: 2rem;
            font-family: 'Georgia', serif;
        }

        html {
            scroll-behavior: smooth;
        }


        /*MENU CARD*/
        .menu-section {
            padding: 40px 0;
        }

        .menu-section:target {
            scroll-margin-top: 100px;
        }

        .menu-card {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 100%;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }


        .menu-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .menu-card img {
            width: 100%;
            height: 220px;
            object-fit: cover;
        }

        .menu-card p {
            color: #444;
            font-size: 0.95rem;
            min-height: 60px;
        }

        .menu-card .price {
            color: #a1692e;
            font-size: 1.2rem;
            font-weight: bold;
        }


        .menu-card-body {
            padding: 15px;
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .menu-card-body .btn {
            margin-top: auto;
        }

        .menu-card h5 {
            color: #3d2700;
            font-weight: bold;
        }


        .btn-primary:hover {
            background-color: #92806b !important;
            border-color: #4a3c2a;
        }

        #searchDropdown {
            position: absolute;
            top: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            width: 100%;

            background: #fff;
            z-index: 999;
            border-radius: 10px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            display: none;
            max-height: 280px;
            padding: 0.5rem 0.75rem;
        }

        form[role="search"] {
            position: relative;
            width: 360px;
        }

        #searchDropdown .dropdown-item-result {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px;
            border-radius: 6px;
            transition: background-color 0.2s ease-in-out;
            cursor: pointer;
        }

        #searchDropdown .dropdown-item-result:hover {
            background-color: #f2f2f2;
        }

        #searchDropdown img {
            width: 45px;
            height: 45px;
            object-fit: cover;
            border-radius: 6px;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark" style="background-color:#382005">
        <div class="container">
            <a class="navbar-brand" href="#"
                style="font-size: 1.8rem; font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif">
                <i class="fa-solid fa-coffee">
                </i>
                THE AP HOUSE
            </a>
            <form class="d-flex ms-4" role="search"
                style="background-color: #5a3e2b; border-radius: 25px; padding: 0 10px;">
                <span class="d-flex align-items-center text-white">
                    <i class="bi bi-search">
                    </i>
                </span>
                <input aria-label="Search" class="form-control border-0 bg-transparent text-white ms-2" id="searchBox"
                    placeholder="Search menu..." style="box-shadow:none; outline:none;" type="search" />
            </form>
            <div class="position-absolute bg-white text-dark rounded shadow mt-2 p-2" id="searchDropdown"
                style="z-index: 1050; width: 100%; display: none; max-height: 300px; overflow-y: auto;">
            </div>
            <button class="navbar-toggler" data-bs-target="#navbarNav" data-bs-toggle="collapse" type="button">
                <span class="navbar-toggler-icon">
                </span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto align-items-center">
                    <li class="nav-item">
                        <a class="nav-link nav-item-custom" href="home.html#about">
                            About
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link nav-item-custom" href="menu.html">
                            Menu
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link nav-item-custom" href="home.html#reservation">
                            Reservation
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link nav-item-custom" href="home.html#contact">
                            Contact
                        </a>
                    </li>
                    <li class="nav-item" id="login-nav">
                        <a class="nav-link nav-item-custom" href="login.html">
                            Login
                        </a>
                    </li>
                    <li class="nav-item ms-4 dropdown d-none" id="account-dropdown">
                        <a class="nav-link dropdown-toggle d-flex align-items-center" data-bs-toggle="dropdown" href="#"
                            id="userDropdown" role="button">
                            <i class="bi bi-person-circle fs-4" style="margin-top: -5px;">
                            </i>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li>
                                <a class="dropdown-item" href="#" id="nav-action-1">
                                    ...
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="#" onclick="logout()">
                                    <i class="bi bi-box-arrow-right me-2">
                                    </i>
                                    Logout
                                </a>
                            </li>
                        </ul>
                    </li>
                    <span class="nav-link fw-semibold d-none nav-item-custom" id="user-role">
                        Admin
                    </span>
                </ul>
            </div>
        </div>
    </nav>
    <section class="category-banner" id="coffee" style="background-image: url('img/cf8.png');">
    </section>
    <section class="menu-section">
        <div class="container">
            <div class="row" id="coffee-list">
            </div>
        </div>
    </section>
    <section class="category-banner" id="tea" style="background-image: url('img/tea8.png');">
    </section>
    <section class="menu-section">
        <div class="container">
            <div class="row" id="tea-list">
            </div>
        </div>
    </section>
    <section class="category-banner" id="matcha" style="background-image: url('img/matcha-banner.png');">
    </section>
    <section class="menu-section">
        <div class="container">
            <div class="row" id="matcha-list">
            </div>
        </div>
    </section>
    <script>
        const API_URL = "http://localhost:3000";

        async function fetchMenu() {
            try {
                const response = await fetch(`${API_URL}/menu`);
                const menu = await response.json();

                const coffeeList = document.getElementById("coffee-list");
                const teaList = document.getElementById("tea-list");
                const matchaList = document.getElementById("matcha-list");

                menu.forEach(item => {
                    const col = document.createElement("div");
                    col.className = "col-lg-4 col-md-6 mb-4";
                    col.innerHTML = `
                    <div class="menu-card h-100 shadow-lg">
                        <img src="${item.image}" class="card-img-top" alt="${item.name}" style="height: 220px; object-fit: cover;">
                        <div class="menu-card-body d-flex flex-column">
                        <h5 class="card-title font-weight-bold" style="font-size:1.3rem;font-family:'Noto Serif'; color: #3d2700;">${item.name}</h5>
                        <p class="card-text font-italic" style="flex-grow: 1;">${item.description}</p>
                        <div class="price mb-2">$${item.price.toFixed(2)}</div>
                        <button class="btn btn-primary w-100 mt-auto" style="background-color: #3d2700;" onclick="orderItem('${item.id}')">
                            Order
                        </button>
                        </div>
                    </div>`

                    if (item.category === "coffee") coffeeList.appendChild(col);
                    else if (item.category === "tea") teaList.appendChild(col);
                    else if (item.category === "matcha") matchaList.appendChild(col);
                });
            } catch (err) {
                console.error("Error:", err);
            }
        }


        function orderItem(id) {
            const token = localStorage.getItem("token");
            if (!token) {
                alert("You need to login to place an order!");
                return;
            }
            window.location.href = `order.html?id=${id}`;
        }


        function scrollToHashAfterLoad() {
            const targetId = window.location.hash?.substring(1);
            if (!targetId) return;

            const el = document.getElementById(targetId);
            if (el) {
                el.scrollIntoView({ behavior: "smooth" });
            }
        }
        function updateNavbar() {
            const token = localStorage.getItem("token");
            const loginNav = document.getElementById("login-nav");
            const accountDropdown = document.getElementById("account-dropdown");
            const actionItem = document.getElementById("nav-action-1");

            if (token) {
                const payload = JSON.parse(atob(token.split(".")[1]));
                loginNav.classList.add("d-none");
                accountDropdown.classList.remove("d-none");

                if (payload.role === "admin") {
                    actionItem.innerHTML = '<i class="bi bi-gear me-2"></i>Setting';
                    actionItem.href = "admin.html";

                    const roleLabel = document.getElementById("user-role");
                    if (roleLabel) {
                        roleLabel.classList.remove("d-none");
                        roleLabel.textContent = "Admin";
                    }
                } else {
                    actionItem.innerHTML = '<i class="bi bi-cart3 me-2"></i>My Cart';
                    actionItem.href = "my_order.html";
                }
            } else {
                loginNav.classList.remove("d-none");
                accountDropdown.classList.add("d-none");
            }
        }
        function logout() {
            localStorage.removeItem("token");
            window.location.reload();
        }

        document.addEventListener("DOMContentLoaded", async () => {
            updateNavbar();
            await fetchMenu();
            scrollToHashAfterLoad();
        });
    </script>


    <script>

        let menuItems = [];
        
        function removeVietnameseTones(str) {
            return str.normalize("NFD").replace(/[̀-ͯ]/g, "").replace(/đ/g, "d").replace(/Đ/g, "D");
        }

        function updateDropdown(keyword) {
            keyword = removeVietnameseTones(keyword.toLowerCase());
            const dropdown = document.getElementById("searchDropdown");
            dropdown.innerHTML = "";

            const matches = menuItems.filter(item => {
                const name = removeVietnameseTones(item.name.toLowerCase());
                const description = removeVietnameseTones(item.description.toLowerCase());
                return name.includes(keyword) || description.includes(keyword);
            });

            if (!keyword || matches.length === 0) {
                dropdown.style.display = "none";
                return;
            }

            matches.forEach(item => {
                const div = document.createElement("div");
                div.className = "dropdown-item-result";
                div.onclick = () => orderItem(item.id);
                div.innerHTML = `
                <img src="${item.image}" alt="${item.name}">
                <div>
                    <div class="fw-semibold">${item.name}</div>
                    <div class="text-muted small">$${item.price.toFixed(2)}</div>
                </div>
            `;
                dropdown.appendChild(div);
            });

            dropdown.style.display = "block";
        }


        document.addEventListener("DOMContentLoaded", () => {
            fetch(`${API_URL}/menu`)
                .then(res => res.json())
                .then(data => {
                    menuItems = data;
                });

            document.getElementById("searchBox").addEventListener("input", (e) => {
                updateDropdown(e.target.value);
            });
        });
    </script>
</body>

</html>